<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMS Logistique - Jumia</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* En-t√™te Jumia */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #f68b1e; padding-bottom: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; color: #282828; font-size: 24px; }
        .header span { background: #f68b1e; color: white; padding: 5px 10px; border-radius: 4px; font-weight: bold; }

        /* Tableau de bord (Dashboard) */
        .dashboard { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 25px; }
        .card { background: #282828; color: white; flex: 1; padding: 15px; border-radius: 6px; text-align: center; }
        .card h3 { margin: 0 0 10px 0; font-size: 14px; color: #f68b1e; text-transform: uppercase; }
        .card p { margin: 0; font-size: 24px; font-weight: bold; }
        .card.highlight { background: #f68b1e; color: white; }
        .card.highlight h3 { color: #282828; }

        /* Formulaire */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 6px; border: 1px solid #ddd; }
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit; }
        button { background: #f68b1e; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; grid-column: 1 / -1; transition: 0.2s; }
        button:hover { background: #e07b19; }

        /* Tableau */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f68b1e; color: white; }
        .badge-jour { background-color: #ffd9b3; color: #cc6600; padding: 3px 8px; border-radius: 12px; font-weight: bold; font-size: 12px;}
        .badge-nuit { background-color: #b3d9ff; color: #004080; padding: 3px 8px; border-radius: 12px; font-weight: bold; font-size: 12px;}
        .btn-delete { background: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>TMS Logistique - Suivi Quotidien</h1>
        <span>JUMIA</span>
    </div>

    <div class="dashboard">
        <div class="card">
            <h3>Effectif Total</h3>
            <p id="dash-effectif">0</p>
        </div>
        <div class="card">
            <h3>Camions Trait√©s</h3>
            <p id="dash-camions">0</p>
        </div>
        <div class="card">
            <h3>Co√ªt Total</h3>
            <p id="dash-cout">0</p>
        </div>
        <div class="card highlight">
            <h3>Productivit√© (Camions/Agent)</h3>
            <p id="dash-prod">0.00</p>
        </div>
    </div>

    <div class="form-grid">
        <div class="form-group"><label>Date</label><input type="date" id="dateInput"></div>
        <div class="form-group">
            <label>Quart (Shift)</label>
            <select id="shiftInput">
                <option value="Jour">‚òÄÔ∏è Jour</option>
                <option value="Nuit">üåô Nuit</option>
            </select>
        </div>
        <div class="form-group"><label>Agents</label><input type="number" id="agentsInput" placeholder="Nbr agents"></div>
        <div class="form-group"><label>Manutentionnaires</label><input type="number" id="manutInput" placeholder="Nbr manut."></div>
        <div class="form-group"><label>Nbr de Camions</label><input type="number" id="camionsInput" placeholder="Camions"></div>
        <div class="form-group"><label>Co√ªt (FCFA)</label><input type="number" id="coutInput" placeholder="Co√ªt total"></div>
        <button onclick="ajouterDonnee()">Enregistrer la donn√©e</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Shift</th>
                <th>Agents</th>
                <th>Manutentionnaires</th>
                <th>Total Effectif</th>
                <th>Camions</th>
                <th>Co√ªt</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
     // --- 1. CONFIGURATION FIREBASE ---
    const firebaseConfig = {
      apiKey: "AIzaSyCzJGbel7mcMHr-sxalOIHagIWIlITHhZk",
      authDomain: "logistique-tms.firebaseapp.com",
      projectId: "logistique-tms",
      storageBucket: "logistique-tms.firebasestorage.app",
      messagingSenderId: "401352839856",
      appId: "1:401352839856:web:639ea196aab034c926e175"
    };

    // Initialisation
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Mettre la date d'aujourd'hui par d√©faut
    document.getElementById('dateInput').valueAsDate = new Date();

    // Fonction pour ajouter
    function ajouterDonnee() {
        const date = document.getElementById('dateInput').value;
        const shift = document.getElementById('shiftInput').value;
        const agents = Number(document.getElementById('agentsInput').value) || 0;
        const manutentionnaires = Number(document.getElementById('manutInput').value) || 0;
        const camions = Number(document.getElementById('camionsInput').value) || 0;
        const cout = Number(document.getElementById('coutInput').value) || 0;

        // Calcul automatique de l'effectif total pour cette ligne
        const effectifTotal = agents + manutentionnaires;

        if(!date) return alert("Veuillez choisir une date !");

        db.collection("logistique").add({
            date: date,
            shift: shift,
            agents: agents,
            manutentionnaires: manutentionnaires,
            effectif: effectifTotal, // On sauvegarde le total
            camions: camions,
            cout: cout,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            document.getElementById('agentsInput').value = '';
            document.getElementById('manutInput').value = '';
            document.getElementById('camionsInput').value = '';
            document.getElementById('coutInput').value = '';
        });
    }

    // Fonction pour supprimer
    function supprimerDonnee(id) {
        if(confirm("Supprimer cette ligne ?")) {
            db.collection("logistique").doc(id).delete();
        }
    }

    // Lecture en temps r√©el et calcul
    db.collection("logistique").orderBy("date", "desc").onSnapshot((querySnapshot) => {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';
        
        let totalEffectifGlobal = 0;
        let totalCamions = 0;
        let totalCout = 0;

        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const id = doc.id;
            
            // Calculs pour le Dashboard
            totalEffectifGlobal += data.effectif || 0;
            totalCamions += data.camions || 0;
            totalCout += data.cout || 0;

            // Choix de la couleur pour Jour/Nuit
            let badgeClass = data.shift === "Nuit" ? "badge-nuit" : "badge-jour";

            // Affichage dans le tableau
            tableBody.innerHTML += `
                <tr>
                    <td>${data.date}</td>
                    <td><span class="${badgeClass}">${data.shift || "-"}</span></td>
                    <td>${data.agents || 0}</td>
                    <td>${data.manutentionnaires || 0}</td>
                    <td><strong>${data.effectif || 0}</strong></td>
                    <td>${data.camions || 0}</td>
                    <td>${data.cout || 0} FCFA</td>
                    <td><button class="btn-delete" onclick="supprimerDonnee('${id}')">Supprimer</button></td>
                </tr>
            `;
        });

        // Mise √† jour du Dashboard
        document.getElementById('dash-effectif').innerText = totalEffectifGlobal;
        document.getElementById('dash-camions').innerText = totalCamions;
        document.getElementById('dash-cout').innerText = totalCout + " FCFA";
        
        // Calcul de la productivit√© globale
        let productivite = 0;
        if(totalEffectifGlobal > 0) {
            productivite = (totalCamions / totalEffectifGlobal).toFixed(2);
        }
        document.getElementById('dash-prod').innerText = productivite + " Camions/Agent";
    });
</script>

</body>
</html>