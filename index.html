<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMS Logistique - Jumia</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* En-tête Jumia */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #f68b1e; padding-bottom: 10px; margin-bottom: 20px; }
        .header h1 { margin: 0; color: #282828; font-size: 24px; }
        .header span { background: #f68b1e; color: white; padding: 5px 10px; border-radius: 4px; font-weight: bold; }

        /* Tableau de bord (Dashboard) */
        .dashboard { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 25px; }
        .card { background: #282828; color: white; flex: 1; padding: 15px; border-radius: 6px; text-align: center; }
        .card h3 { margin: 0 0 10px 0; font-size: 14px; color: #f68b1e; text-transform: uppercase; }
        .card p { margin: 0; font-size: 24px; font-weight: bold; }
        .card.highlight { background: #f68b1e; color: white; }
        .card.highlight h3 { color: #282828; }

        /* Formulaire */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 6px; border: 1px solid #ddd; }
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #555; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #f68b1e; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; grid-column: 1 / -1; transition: 0.2s; }
        button:hover { background: #e07b19; }

        /* Tableau */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f68b1e; color: white; font-size: 14px; }
        .btn-delete { background: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>TMS Logistique - Suivi Quotidien</h1>
        <span>JUMIA</span>
    </div>

    <div class="dashboard">
        <div class="card">
            <h3>Effectif Staffé</h3>
            <p id="dash-effectif">0</p>
        </div>
        <div class="card">
            <h3>Camions Traités</h3>
            <p id="dash-camions">0</p>
        </div>
        <div class="card">
            <h3>Coût Total</h3>
            <p id="dash-cout">0</p>
        </div>
        <div class="card highlight">
            <h3>Productivité (Camions/Agent)</h3>
            <p id="dash-prod">0.00</p>
        </div>
    </div>

    <div class="form-grid">
        <div class="form-group"><label>Date</label><input type="date" id="dateInput"></div>
        <div class="form-group"><label>Équipe / Zone</label><input type="text" id="equipeInput" placeholder="Ex: Équipe Matin"></div>
        <div class="form-group"><label>Effectif</label><input type="number" id="effectifInput" placeholder="Nombre d'agents"></div>
        <div class="form-group"><label>Nbr de Camions</label><input type="number" id="camionsInput" placeholder="Camions chargés/déchargés"></div>
        <div class="form-group"><label>Coût (FCFA)</label><input type="number" id="coutInput" placeholder="Coût total"></div>
        <button onclick="ajouterDonnee()">Enregistrer la donnée</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Équipe / Zone</th>
                <th>Effectif</th>
                <th>Camions</th>
                <th>Coût</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
       // --- 1. CONFIGURATION FIREBASE ---
    const firebaseConfig = {
      apiKey: "AIzaSyCzJGbel7mcMHr-sxalOIHagIWIlITHhZk",
      authDomain: "logistique-tms.firebaseapp.com",
      projectId: "logistique-tms",
      storageBucket: "logistique-tms.firebasestorage.app",
      messagingSenderId: "401352839856",
      appId: "1:401352839856:web:639ea196aab034c926e175"
    };

    // Initialisation
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Mettre la date d'aujourd'hui par défaut
    document.getElementById('dateInput').valueAsDate = new Date();

    // Fonction pour ajouter
    function ajouterDonnee() {
        const date = document.getElementById('dateInput').value;
        const equipe = document.getElementById('equipeInput').value;
        const effectif = Number(document.getElementById('effectifInput').value);
        const camions = Number(document.getElementById('camionsInput').value);
        const cout = Number(document.getElementById('coutInput').value);

        if(!date || !equipe) return alert("Remplissez la date et l'équipe !");

        db.collection("logistique").add({
            date: date,
            equipe: equipe,
            effectif: effectif,
            camions: camions,
            cout: cout,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            document.getElementById('equipeInput').value = '';
            document.getElementById('effectifInput').value = '';
            document.getElementById('camionsInput').value = '';
            document.getElementById('coutInput').value = '';
        });
    }

    // Fonction pour supprimer
    function supprimerDonnee(id) {
        if(confirm("Supprimer cette ligne ?")) {
            db.collection("logistique").doc(id).delete();
        }
    }

    // Lecture en temps réel et calcul du Dashboard
    db.collection("logistique").orderBy("date", "desc").onSnapshot((querySnapshot) => {
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';
        
        let totalEffectif = 0;
        let totalCamions = 0;
        let totalCout = 0;

        querySnapshot.forEach((doc) => {
            const data = doc.data();
            const id = doc.id;
            
            // Calculs pour le Dashboard
            totalEffectif += data.effectif || 0;
            totalCamions += data.camions || 0;
            totalCout += data.cout || 0;

            // Affichage dans le tableau
            tableBody.innerHTML += `
                <tr>
                    <td>${data.date}</td>
                    <td>${data.equipe}</td>
                    <td>${data.effectif || 0}</td>
                    <td>${data.camions || 0}</td>
                    <td>${data.cout || 0} FCFA</td>
                    <td><button class="btn-delete" onclick="supprimerDonnee('${id}')">Supprimer</button></td>
                </tr>
            `;
        });

        // Mise à jour de l'affichage du Dashboard
        document.getElementById('dash-effectif').innerText = totalEffectif;
        document.getElementById('dash-camions').innerText = totalCamions;
        document.getElementById('dash-cout').innerText = totalCout + " FCFA";
        
        // Calcul de la productivité (Camions divisé par Effectif)
        let productivite = 0;
        if(totalEffectif > 0) {
            productivite = (totalCamions / totalEffectif).toFixed(2);
        }
        document.getElementById('dash-prod').innerText = productivite + " Camions/Agent";
    });
</script>

</body>
</html>